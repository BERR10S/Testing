<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>Testing</title>
  <!-- Core theme CSS (includes Bootstrap)-->
  <link href="css/styles.css" rel="stylesheet">
</head>
<body>
<header class="masthead">
  <div class="container px-4 px-lg-5 h-100">
    <div class="row gx-4 gx-lg-5 h-100 align-items-center justify-content-center text-center">
      <div class="col-lg-8 align-self-end">
        <h1 class="text-white font-weight-bold">Pruebas Iframe</h1>
        <hr class="divider">
      </div>
      <div class="col-lg-8 align-self-baseline">
<!--        <a id="test" class="btn btn-primary btn-xl">Obtener cookies</a>-->
        <p id="contentCookie" style="color: white"></p>
      </div>
    </div>
  </div>
</header>
<!-- Footer-->
<footer class="bg-light py-5">
  <div class="container px-4 px-lg-5">
    <div class="small text-center text-muted">Copyright © 2021 - Berr10s</div>
  </div>
</footer>
<!-- Bootstrap core JS-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script>
  $( document ).ready(function() {
    console.log('URL IFRAME ' + document.location.href)
    const url = new URL(document.location.href);
    const search_params = url.searchParams;

    console.log('tiene campo: ' + search_params.get('gdpr_consent'))
    if (search_params.get('gdpr_consent') !== '') {
      console.log('Cookies aceptadas en padre')
      document.getElementById("contentCookie").innerHTML = search_params.get('gdpr_consent');
    } else {
      console.log('Esperando aceptar las cookies')
      document.getElementById("contentCookie").innerHTML = 'Esperando aceptar las cookies';
    }
    // new value of "new_url" is set to "params cookie web padre"
    console.log('URL PROPIA ' + document.location.href)
    console.log('URL PADRE ' + document.referrer)
    // document.getElementById("contentCookie").innerHTML = search_params.get('gdpr_consent');
    // let consent_string = "";
    // window.__tcfapi('getTCData', 2, function(tcData, success) { console.log('cmp responded:', tcData, success);
    //   consent_string=tcData.tcString;
    //   console.log("CMP_CONSENT:"+consent_string);
    // });
    //
    // console.log('Recorremos todos los iframes de la web que sean de nuestra plataforma')
    // let iframes = document.getElementsByTagName('iframe')
    // for (let i=0; i<iframes.length; i+=1) {
    //   expresion = /^https:\/\/vozpopulitv.vozpopuli\.com\//;
    //   expresion = /^https:\/\/berr10s.github\.io\//;
    //   if (expresion.test(iframes[i].src)) {
    //     // iframes[i].src = "https://berr10s.github.io/Testing?consent=JUAN"
    //     const url = new URL(iframes[i].src)
    //     // añadimos el gdpr_consent a la url del iframe para capturarlo luego
    //     url.searchParams.append('gdpr_consent', consent_string);
    //     // Sustituimos la url completa ya modificada
    //     url.search = url.searchParams.toString();
    //     // Se la asignamos al iframe
    //     iframes[i].src = url.toString()
    //   }
    //
    // }



  })
</script>
</body>
</html>
